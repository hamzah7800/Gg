<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Badminton Mobile</title>
<style>
body,html { margin:0; padding:0; background:#5ac; overflow:hidden; }
#overlay {
  position:fixed; top:0; left:0; right:0; bottom:0;
  background:#111; color:#fff; display:flex; align-items:center; justify-content:center;
  font-family:sans-serif; font-size:1.5em; text-align:center; padding:20px;
}
canvas { display:block; touch-action:none; }
#joystick, #shotbtn {
  position:fixed; bottom:20px; background:rgba(255,255,255,0.2);
  border-radius:50%; touch-action:none;
}
#joystick { left:20px; width:120px; height:120px; }
#shotbtn { right:20px; width:100px; height:100px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#fff; }
</style>
</head>
<body>
<div id="overlay">Mobile only! Please open on a touch device.</div>
<canvas id="game"></canvas>
<div id="joystick"></div>
<div id="shotbtn">SHOT</div>
<script>
const isTouch = 'ontouchstart' in window;
if (isTouch) document.getElementById('overlay').style.display = 'none';

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = window.innerWidth, H = window.innerHeight;
canvas.width = W; canvas.height = H;

let player = { x:W*0.2, y:H*0.5, r:20, swing:false, swingTime:0, vx:0, vy:0 };
let ai = { x:W*0.8, y:H*0.5, r:20, vx:0, vy:0 };
let shuttle = { x:W/2, y:H/2, vx:200, vy:-150, angle:0, rot:0 };
const netY = H/2;
let lastTime = 0;
const HIT_RADIUS = 45;
const HIT_WINDOW = 0.15;
const AIM_ASSIST_ANGLE = 20 * Math.PI/180;

// Draw shuttlecock
function drawShuttle(c,x,y,angle){
  c.save();
  c.translate(x,y);
  c.rotate(angle);
  // Feathers
  c.beginPath();
  for (let i=0;i<6;i++){
    let rad=(i/6)*Math.PI*2;
    c.moveTo(0,0);
    c.lineTo(Math.cos(rad)*12,Math.sin(rad)*12);
  }
  c.strokeStyle='#eee';
  c.lineWidth=2;
  c.stroke();
  // Head
  c.beginPath();
  c.arc(0,0,5,0,Math.PI*2);
  c.fillStyle='#fff';
  c.fill();
  c.restore();
}

// Joystick control
let joy = { active:false, startX:0, startY:0, dx:0, dy:0 };
const joyEl = document.getElementById('joystick');
joyEl.addEventListener('touchstart',e=>{
  const t=e.touches[0]; joy.active=true; joy.startX=t.clientX; joy.startY=t.clientY; joy.dx=joy.dy=0;
});
joyEl.addEventListener('touchmove',e=>{
  const t=e.touches[0];
  joy.dx=t.clientX-joy.startX; joy.dy=t.clientY-joy.startY;
});
joyEl.addEventListener('touchend',()=>{ joy.active=false; joy.dx=joy.dy=0; });

let shotPressed=false;
const shotBtn = document.getElementById('shotbtn');
shotBtn.addEventListener('touchstart',()=>{ shotPressed=true; player.swing=true; player.swingTime=0; });
shotBtn.addEventListener('touchend',()=>{ shotPressed=false; });

function update(dt){
  // Player move
  let spd=200;
  player.vx=joy.dx/60*spd; player.vy=joy.dy/60*spd;
  player.x+=player.vx*dt; player.y+=player.vy*dt;
  player.x=Math.max(player.r,Math.min(W/2-player.r,player.x));
  player.y=Math.max(player.r,Math.min(H-player.r,player.y));

  // AI move
  let targetY=shuttle.y;
  ai.y+= (targetY-ai.y)*dt*2;
  ai.x = Math.min(W-ai.r, Math.max(W/2+ai.r, ai.x));

  // Shuttle move
  shuttle.x+=shuttle.vx*dt;
  shuttle.y+=shuttle.vy*dt;
  shuttle.vy+=200*dt; // gravity
  shuttle.rot += 5*dt;

  // Bounce on floor
  if (shuttle.y > H-10){ shuttle.vy*=-0.6; shuttle.y=H-10; }
  // Left/right bounds
  if (shuttle.x<5 || shuttle.x>W-5) shuttle.vx*=-1;
  // Net collision
  if (Math.abs(shuttle.x-W/2)<5 && shuttle.y<netY+50 && shuttle.y>netY-50){
    shuttle.vx*=-0.8;
  }

  // Player hit
  if (player.swing){
    player.swingTime+=dt;
    let dx=shuttle.x-player.x, dy=shuttle.y-player.y;
    let dist=Math.hypot(dx,dy);
    if (dist<HIT_RADIUS && player.swingTime<HIT_WINDOW){
      let aimX = ai.x, aimY = ai.y; // aim toward AI
      let angle = Math.atan2(aimY-shuttle.y, aimX-shuttle.x);
      let diff = ((angle - Math.atan2(dy,dx) + Math.PI*3)%(Math.PI*2))-Math.PI;
      if (Math.abs(diff) < AIM_ASSIST_ANGLE) angle -= diff; // assist
      let speed=300;
      shuttle.vx = Math.cos(angle)*speed;
      shuttle.vy = Math.sin(angle)*speed - 100;
      shuttle.rot = 0;
      player.swing=false;
    }
    if (player.swingTime>HIT_WINDOW) player.swing=false;
  }

  // AI hit
  let adx=shuttle.x-ai.x, ady=shuttle.y-ai.y;
  if (Math.hypot(adx,ady)<HIT_RADIUS && shuttle.x>W/2){
    let angle = Math.atan2(player.y-shuttle.y, player.x-shuttle.x);
    let speed=300;
    shuttle.vx = Math.cos(angle)*speed;
    shuttle.vy = Math.sin(angle)*speed - 100;
    shuttle.rot = 0;
  }
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // Court
  ctx.fillStyle='#4c8';
  ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#283';
  ctx.fillRect(0,H/2-5,W,10); // net
  // Players
  ctx.fillStyle='#f22'; ctx.beginPath(); ctx.arc(player.x,player.y,player.r,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='#22f'; ctx.beginPath(); ctx.arc(ai.x,ai.y,ai.r,0,Math.PI*2); ctx.fill();
  // Shuttle
  drawShuttle(ctx,shuttle.x,shuttle.y,shuttle.rot);
}

function loop(ts){
  if (!lastTime) lastTime=ts;
  let dt=(ts-lastTime)/1000;
  lastTime=ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

window.addEventListener('resize',()=>{ W=window.innerWidth; H=window.innerHeight; canvas.width=W; canvas.height=H; });
</script>
</body>
</html>
